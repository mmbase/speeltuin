<%@ page errorPage="exception.jsp"%><%@page import="org.mmbase.bridge.*,	javax.servlet.jsp.JspException,	java.util.Locale,	java.util.List,	java.util.ArrayList,	java.util.Enumeration,	nl.hcs.mmbase.TranslationModule,	nl.hcs.util.WordHtmlCleaner"%><%@ taglib uri="http://www.mmbase.org/mmbase-taglib-1.0" prefix="mm"%><mm:import externid="loginmethod" from="parameters">loginpage</mm:import><mm:locale language="en"><mm:cloud method="$loginmethod" loginpage="login.jsp" jspvar="cloud"><mm:log jspvar="log"><mm:import externid="cmd" jspvar="cmd" required="true" /><mm:import externid="objectnumber" jspvar="objectnumber" vartype="Integer" required="true" /><mm:import externid="fields" required="true" jspvar="fields"/><mm:import externid="input" jspvar="input" >text</mm:import><mm:import externid="language">en</mm:import><mm:import externid="editid"/><%if (cmd.indexOf("commit") > -1) {// parse fields to determine later if we need html cleaning	List fieldList = new ArrayList();	List inputList = new ArrayList();   int i = 0;	while((i = fields.indexOf(",")) > -1) {		fieldList.add(fields.substring(0, i));		fields = fields.substring(i+1);	}	fieldList.add(fields);	input = input.toLowerCase();	int j = 0;	while((j = input.indexOf(",")) > -1) {		inputList.add(input.substring(0, j));		input = input.substring(j+1);	}	inputList.add(input);	while ( fieldList.size() >= inputList.size() ) {		inputList.add("text");	}// get translation module	TranslationModule translationModule =		(TranslationModule) org.mmbase.module.Module.getModule("TRANSLATIONS");// process field language/country and values	Enumeration params = request.getParameterNames();	while (params.hasMoreElements()) {		String name = (String) params.nextElement();      if (name.startsWith("field/")) {			int begin = name.indexOf("/") + 1;			int end = name.indexOf("/", begin);			String language = name.substring(begin, end);			begin = end + 1;			end = name.indexOf("/", begin);			String country = name.substring(begin, end);			begin = end + 1;			String fieldname = name.substring(begin);			String fieldvalue = request.getParameter(name);			int a = fields.indexOf(fieldname);			if (a > -1) {				if (((String) inputList.get(a)).startsWith("html")) {					//clean html field					fieldvalue = WordHtmlCleaner.cleanHtml(fieldvalue);				}			}			translationModule.updateTranslation(objectnumber.intValue(),			                                    fieldname,			                                    language,			                                    country,			                                    fieldvalue);		}	}} %><mm:write referid="editid" jspvar="editid" ><mm:isnotempty>	<mm:node number="$editid">	   <mm:import id="jsppage" reset="true"><mm:field name="jsppage"/></mm:import>	   <mm:import id="builder" reset="true"><mm:field name="builder"/></mm:import>	   <mm:import id="constraints" reset="true"><mm:field name="constraints"/></mm:import>	   <mm:import id="fields" reset="true"><mm:field name="fields"/></mm:import>	   <mm:import id="orderby" reset="true"><mm:field name="orderby"/></mm:import>	   <mm:import id="directions" reset="true"><mm:field name="directions"/></mm:import>	   <mm:import id="translationfields" reset="true"><mm:field name="translationfields"/></mm:import>	   <mm:import id="translationinput" reset="true"><mm:field name="translationinput"/></mm:import>	   <mm:import id="show" reset="true"><mm:field name="display"/></mm:import>		<html>	  <head>	    <meta http-equiv="refresh" content="0; url=<mm:url referids="builder,constraints,fields,orderby,directions,translationfields,translationinput,show,language,editid" page="$jsppage" />""/>	  </head>	  <body>	    <div>	      <div>Changes have been made</div>	      <p>If you are not automatically redirected, continue on to <a href="<mm:url referids="builder,constraints,fields,orderby,directions,translationfields,translationinput,show,language,editid" page="$jsppage" />"">the next page</a>.</p>	    </div>	  </body>	</html>		</mm:field>	</mm:node></mm:isnotempty><mm:isempty><%-- Probably, coming from the edit wizard screens.	Translation is in a popup.--%>	<html>	<script language="Javascript">	window.close();	</script>	</html></mm:isempty></mm:write></mm:log></mm:cloud></mm:locale>