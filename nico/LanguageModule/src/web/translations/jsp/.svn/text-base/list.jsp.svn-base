<%@ page errorPage="exception.jsp"%><%@page import="org.mmbase.bridge.*,javax.servlet.jsp.JspException"%><%@ taglib uri="http://www.mmbase.org/mmbase-taglib-1.0" prefix="mm"%><mm:import externid="loginmethod" from="parameters">loginpage</mm:import><mm:locale language="en"><mm:cloud method="$loginmethod" loginpage="login.jsp" jspvar="cloud"><mm:log jspvar="log"><mm:import externid="builder" required="true"/><mm:import externid="fields" required="true"/><mm:import externid="orderby"/><mm:import externid="constraints"/><mm:import externid="directions">up</mm:import><mm:import externid="start">0</mm:import><mm:import externid="pagelength">50</mm:import><mm:import externid="age">9999</mm:import><mm:import externid="translationfields" required="true"/><mm:import externid="translationinput">text</mm:import><mm:import externid="editid" required="true"/><mm:import externid="show">vertical</mm:import><mm:write referid="orderby"><mm:isempty><mm:remove referid="orderby"/><mm:import id="orderby"><mm:write referid="fields"/></mm:import></mm:isempty></mm:write><mm:import id="listurl">list.jsp?builder=<mm:write referid="builder"/>&fields=<mm:write referid="fields"/>&orderby=<mm:write referid="orderby"/>&directions=<mm:write referid="directions"/>&pagelength=<mm:write referid="pagelength"/>&age=<mm:write referid="age"/>&translationfields=<mm:write referid="translationfields"/>&translationinput=<mm:write referid="translationinput"/><mm:write referid="constraints"><mm:isnotempty>&constraints=<mm:write referid="constraints"/></mm:isnotempty></mm:write></mm:import><mm:import id="title"><mm:write referid="builder"/></mm:import><% String ageconstraint = "[number]>0"; %><mm:write referid="age" jspvar="searchage" vartype="Integer"><mm:isnotempty><%if (searchage.intValue() > -1) {    // maxlistConfig.age is set. pre-query to find objectnumber    long daymarker = (new java.util.Date().getTime() / (60*60*24*1000)) - searchage.intValue();    NodeManager mgr = cloud.getNodeManager("daymarks");    NodeList tmplist = mgr.getList("daycount>="+daymarker, null,null);    if (tmplist.size()<1) {        // not found. No objects can be found.        ageconstraint = "[number]>99999";    } else {        Node n = tmplist.getNode(0);        ageconstraint = "[number]>"+n.getStringValue("mark");    }}%></mm:isnotempty></mm:write><mm:write referid="constraints"><mm:isnotempty><mm:import id="fullconstraints"><mm:write referid="constraints"/> AND <%= ageconstraint %></mm:import></mm:isnotempty><mm:isempty><mm:import id="fullconstraints"><%= ageconstraint %></mm:import></mm:isempty></mm:write><mm:write referid="start" vartype="Integer" jspvar="start" write="false"><mm:import id="listindex"><%= start.intValue() + 1 %></mm:import></mm:write><mm:listnodes type="$builder" constraints="$fullconstraints">	<mm:first><mm:size id="size" write="false"/></mm:first></mm:listnodes><mm:notpresent referid="size">	<mm:import id="size">0</mm:import></mm:notpresent><html><head><meta CONTENT="text/html; charset=utf-8" HTTP-EQUIV="Content-Type" /><title>List</title><link href="../style/list.css" type="text/css" rel="stylesheet" /><link href="../style.css" type="text/css" rel="stylesheet" /><script language="javascript"><!--   window.history.forward(1);   var cancelClick = false;   function objMouseOver(el) {   el.className="itemrow-hover";   }   function objMouseOut(el) {   el.className="itemrow";   }   function objClick(el) {	   if (cancelClick) {		   cancelClick=false;		   return;	   }	   var href = el.getAttribute("href")+"";	   if (href.length<10) return;	   document.location=href + "&clientwidth=" + (document.body.clientWidth);   }   --></script></head><body onLoad="window.focus();"><table class="body"><tr><th colspan="2"><span class="title"><nobr><mm:write referid="title"/></nobr></span></th></tr><tr><td class="left" /><td class="listcanvas"><div class="subhead" title="These are the items that you can edit."><nobr><mm:write referid="title"/> (<mm:write referid="size"/> items)</nobr></div><br /><br /><table><%-- List --%><mm:listnodes type="$builder"			orderby="$orderby"			directions="$directions"			offset="$start"			max="$pagelength"			constraints="$fullconstraints"><mm:first><tr><th class="number">#</th><mm:fieldlist fields="$fields">    <th><mm:fieldinfo type="guiname" />&nbsp;</th></mm:fieldlist></tr></mm:first><tr class="itemrow" onMouseOver="objMouseOver(this);" onMouseDown="objClick(this);" onMouseOut="objMouseOut(this);"href="<mm:url page="translate.jsp">		<mm:param name="fields"><mm:write referid="translationfields"/></mm:param>		<mm:param name="input"><mm:write referid="translationinput"/></mm:param>		<mm:param name="objectnumber"><mm:field name="number"/></mm:param>		<mm:param name="editid"><mm:write referid="editid"/></mm:param>		<mm:param name="show"><mm:write referid="show"/></mm:param>	</mm:url>"><td class="number"><mm:index offset="$listindex"/>.&nbsp;</td><mm:fieldlist fields="$fields">    <td><mm:fieldinfo type="value" />&nbsp;</td></mm:fieldlist></tr></mm:listnodes><%-- Page navigation --%><tr><td class="left" /><td><mm:isgreaterthan referid="size" referid2="pagelength"><mm:write referid="size" vartype="Integer" jspvar="size" write="false"><mm:write referid="pagelength" vartype="Integer" jspvar="pagelength" write="false"><mm:write referid="start" vartype="Integer" jspvar="start" write="false"><%	int previousStart = (start.intValue() - pagelength.intValue()) >= 0 ? start.intValue() - pagelength.intValue() : 0;	int nextStart = (start.intValue() + pagelength.intValue()) > size.intValue() ? start.intValue() : start.intValue() + pagelength.intValue();	int currentPage = (start.intValue() / pagelength.intValue()) + 1;	int totalPages = (size.intValue() / pagelength.intValue());	if (size.intValue() % pagelength.intValue() != 0) totalPages += 1;	int offsetPage = (start.intValue() % pagelength.intValue());%><div><span class="pagenav"><a href="<mm:write referid="listurl" jspvar="listurl"/>&start=<%= previousStart %>" title="Back to PAGE" class="pagenav"> &lt;&lt; </a> &nbsp;<% for (int i = 1;i <= totalPages;i++) {	   if (i == currentPage) {%>	<%= i %> &nbsp;<%     } else { %>	<a href="<mm:write referid="listurl" jspvar="listurl"/>&start=<%= ((i-1)*pagelength.intValue())+offsetPage %>" class="pagenav"><%= i %></a> &nbsp;<%     }   } %><a href="<mm:write referid="listurl" jspvar="listurl"/>&start=<%= nextStart %>" title="Forward to PAGE" class="pagenav"> &gt;&gt;</a></span><br /><br /></div></mm:write></mm:write></mm:write></mm:isgreaterthan></td></tr></table></body></html></mm:log></mm:cloud></mm:locale>